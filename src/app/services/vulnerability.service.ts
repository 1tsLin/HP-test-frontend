import { Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Observable } from 'rxjs';
import { Vulnerability } from '../models/vulnerability.model';
import { StatusEnum } from '../models/enums/status.enum';
import { SeverityEnum } from '../models/enums/severity.enum';

@Injectable({
  providedIn: 'root'
})
export class VulnerabilityService {

    private apiUrl = 'http://localhost:8080/api/vulnerabilities';

    constructor(private http: HttpClient) {}

    // GET
    getVulnerabilities(severity?: SeverityEnum): Observable<Vulnerability[]> {
        let params = new HttpParams();
        
        if (severity) {
            params = params.set('severity', severity);
        }

        return this.http.get<Vulnerability[]>(this.apiUrl, { params });
    }

    // UPDATE status
    updateVulnerabilityStatus(id: string, status: StatusEnum) {
        this.http.put<{ status: StatusEnum }>(`${this.apiUrl}/${id}/status`, { status });
    }
}
